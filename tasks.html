<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>Tasks</title>
<link type="text/css" rel="stylesheet" href="css/tasks.css" />
<link type="text/css" rel="stylesheet" href="css/ui-darkness/jquery-ui-1.9.0.custom.min.css" />
</head>
<body>
  <div id="tasks">
    <div class="credit">
      Concept by <a href="http://homes.cs.washington.edu/~ajaffe">Alex Jaffe</a>.
    </div>
    <script type="text/javascript">
    task_list = {
    	"name" : "tasks",
    	"children" : [{% for task in tasks %}
    	    { "name": "{{task[0]}}", "size": {{task[1]}} },
    	{% endfor %}]
    };
    </script>
    <script type="text/javascript" src="js/d3.v2.min.js"></script>
    <script type="text/javascript" src="js/tasks.js"></script>
    <script type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.9.0.custom.min.js"></script>
    <script type="text/javascript">
		$(function(){

			// Dialog
			$('#dialog').dialog({
				autoOpen: false,
				modal: true,
				width: 350,
				buttons: {
					"Ok": function() {
						if (validateForm()) {
							$( '#new_task_form' ).submit();
							$(this).dialog("close");
						}
					},
					"Cancel": function() {
						$(this).dialog("close");
					}
				}
			});

			// Dialog Link
			$('#dialog_link').click(function(){
				$('#dialog').dialog('open');
				return false;
			});

			//hover states on the static widgets
			$('#dialog_link').hover(
				function() { $(this).addClass('ui-state-hover'); },
				function() { $(this).removeClass('ui-state-hover'); }
			);

			$( "#new-task" )
				.button({
	    			icons : {
	    	    		primary : "ui-icon-plus",
	    			},
	    			text : false
	  			}).click(function() {
					$( "#dialog" ).dialog( "open" );
				});

			// The date picker inside the dialog
			$( "#task-date" ).datepicker();
			// Set the date and time to 1 hour from now.
			var curTime = new Date().getTime(),
			    oneHour = new Date(curTime + 60*60*1000);
			oneHour.setMinutes(0);
			oneHour.setSeconds(0);
			oneHour.setMilliseconds(0);
			var dateString = (oneHour.getMonth()+1) + "/" + oneHour.getDate() + "/" + oneHour.getFullYear(),
			    timeString = oneHour.getHours() + ":00";
			$( "#task-date" ).attr("value", dateString);
			$( "#task-time" ).attr("value", timeString);
		});
		
		function validateForm() {
			var date_string = $( "#task-date" ).val();
			var time_string = $( "#task-time" ).val();
			var d = Date.parse(date_string + " " + time_string);
			var now = new Date();
			if (isNaN(d) || (d < now)) {
				return false;
			}
			
			$( "#ends" ).attr("value", d);
			
			return true;
		};
	</script>
    <div id="dialog" title="New task">
      <form id="new_task_form" action="/new" method="post" onSubmit="return validateForm();">
        <p>
          <label for="task-name">Name:</label> <input type="text" name="description" id="description" placeholder="Do laundry" />
        </p>
        <p>
          <label for="task-date">Date:</label> <input type="text" id="task-date" />
        </p>
        <p>
          <label for="task-time">Time:</label> <input type="text" id="task-time" />
        </p>
        <input type="hidden" name="ends" id="ends" />
      </form>
    </div>
    <div class="newbutton">
      <button id="new-task">New task</button>
    </div>
  </div>
</body>
</html>
